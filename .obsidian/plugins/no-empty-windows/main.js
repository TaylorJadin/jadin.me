/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var __defProp = Object.defineProperty;
var __getOwnPropDesc = Object.getOwnPropertyDescriptor;
var __getOwnPropNames = Object.getOwnPropertyNames;
var __hasOwnProp = Object.prototype.hasOwnProperty;
var __export = (target, all) => {
  for (var name in all)
    __defProp(target, name, { get: all[name], enumerable: true });
};
var __copyProps = (to, from, except, desc) => {
  if (from && typeof from === "object" || typeof from === "function") {
    for (let key of __getOwnPropNames(from))
      if (!__hasOwnProp.call(to, key) && key !== except)
        __defProp(to, key, { get: () => from[key], enumerable: !(desc = __getOwnPropDesc(from, key)) || desc.enumerable });
  }
  return to;
};
var __toCommonJS = (mod) => __copyProps(__defProp({}, "__esModule", { value: true }), mod);

// main.ts
var main_exports = {};
__export(main_exports, {
  default: () => NoEmptyWindows
});
module.exports = __toCommonJS(main_exports);
var import_obsidian = require("obsidian");
var DEFAULT_SETTINGS = {
  unpin: true,
  allowEmpty: true
};
var SettingTab = class extends import_obsidian.PluginSettingTab {
  constructor(app, plugin) {
    super(app, plugin);
    this.plugin = plugin;
  }
  display() {
    const { containerEl } = this;
    containerEl.empty();
    new import_obsidian.Setting(containerEl).setName("Unpin tabs").setDesc("Enable to unpin pinned tabs instead of closing them directly.").addToggle(
      (toggle) => toggle.setValue(this.plugin.settings.unpin).onChange(async (value) => {
        this.plugin.settings.unpin = value;
        await this.plugin.saveSettings();
      })
    );
    new import_obsidian.Setting(containerEl).setName("Allow empty tabs").setDesc(
      "Disable to close the window immediately when the last tab is closed, instead of spawning an empty tab."
    ).addToggle(
      (toggle) => toggle.setValue(this.plugin.settings.allowEmpty).onChange(async (value) => {
        this.plugin.settings.allowEmpty = value;
        await this.plugin.saveSettings();
      })
    );
  }
};
var NoEmptyWindows = class extends import_obsidian.Plugin {
  async onload() {
    await this.loadSettings();
    this.addSettingTab(new SettingTab(this.app, this));
    this.addCommand({
      id: "close-tab-or-empty-window",
      name: "Close current tab or empty window",
      callback: () => {
        const workspace = this.app.workspace;
        const leaves = [];
        workspace.iterateAllLeaves((leaf) => {
          leaf.view.navigation && leaves.push(leaf);
        });
        const activeLeaf = workspace.getMostRecentLeaf();
        let activeGroup = activeLeaf.parent;
        switch (true) {
          case (this.settings.unpin && (activeLeaf == null ? void 0 : activeLeaf.getViewState().pinned)):
            activeLeaf.setPinned(false);
            break;
          case (leaves.length === 1 && activeLeaf.view.getViewType() === "empty"):
            activeLeaf.getContainer().win.close();
            break;
          case (leaves.length === 1 && (!this.settings.allowEmpty || this.settings.allowEmpty && activeLeaf.view.getViewType() === "empty")):
            activeLeaf.getContainer().win.close();
            break;
          case (leaves.length > 1 && activeGroup.children.length === 1):
            const relatives = activeGroup.parent.children;
            const activeGroups = relatives.length > 1 ? relatives.filter((child) => child != activeGroup).sort(
              (a, b) => a.children.length - b.children.length
            ) : [...new Set(leaves.map((leaf) => leaf.parent))].filter((group) => group != activeGroup).sort((a, b) => a.children.length - b.children.length);
            activeGroup = activeGroups[0];
            const activeLeaves = activeGroup.children;
            const nextActiveLeaf = activeLeaves[activeGroup.currentTab];
            workspace.setActiveLeaf(nextActiveLeaf, { focus: true });
          default:
            activeLeaf.detach();
        }
      }
    });
  }
  onunload() {
  }
  async loadSettings() {
    this.settings = Object.assign({}, DEFAULT_SETTINGS, await this.loadData());
  }
  async saveSettings() {
    await this.saveData(this.settings);
  }
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsibWFpbi50cyJdLAogICJzb3VyY2VzQ29udGVudCI6IFsiaW1wb3J0IHtcbiAgQXBwLFxuICBQbHVnaW4sXG4gIFBsdWdpblNldHRpbmdUYWIsXG4gIFNldHRpbmcsXG4gIFdvcmtzcGFjZUxlYWYsXG59IGZyb20gXCJvYnNpZGlhblwiO1xuXG5pbnRlcmZhY2UgTXlQbHVnaW5TZXR0aW5ncyB7XG4gIHVucGluOiBib29sZWFuO1xuICBhbGxvd0VtcHR5OiBib29sZWFuO1xufVxuXG5jb25zdCBERUZBVUxUX1NFVFRJTkdTOiBNeVBsdWdpblNldHRpbmdzID0ge1xuICB1bnBpbjogdHJ1ZSxcbiAgYWxsb3dFbXB0eTogdHJ1ZSxcbn07XG5cbmNsYXNzIFNldHRpbmdUYWIgZXh0ZW5kcyBQbHVnaW5TZXR0aW5nVGFiIHtcbiAgcGx1Z2luOiBOb0VtcHR5V2luZG93cztcbiAgY29uc3RydWN0b3IoYXBwOiBBcHAsIHBsdWdpbjogTm9FbXB0eVdpbmRvd3MpIHtcbiAgICBzdXBlcihhcHAsIHBsdWdpbik7XG4gICAgdGhpcy5wbHVnaW4gPSBwbHVnaW47XG4gIH1cbiAgZGlzcGxheSgpOiB2b2lkIHtcbiAgICBjb25zdCB7IGNvbnRhaW5lckVsIH0gPSB0aGlzO1xuICAgIGNvbnRhaW5lckVsLmVtcHR5KCk7XG4gICAgbmV3IFNldHRpbmcoY29udGFpbmVyRWwpXG4gICAgICAuc2V0TmFtZShcIlVucGluIHRhYnNcIilcbiAgICAgIC5zZXREZXNjKFwiRW5hYmxlIHRvIHVucGluIHBpbm5lZCB0YWJzIGluc3RlYWQgb2YgY2xvc2luZyB0aGVtIGRpcmVjdGx5LlwiKVxuICAgICAgLmFkZFRvZ2dsZSgodG9nZ2xlKSA9PlxuICAgICAgICB0b2dnbGUuc2V0VmFsdWUodGhpcy5wbHVnaW4uc2V0dGluZ3MudW5waW4pLm9uQ2hhbmdlKGFzeW5jICh2YWx1ZSkgPT4ge1xuICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLnVucGluID0gdmFsdWU7XG4gICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG4gICAgICAgIH0pXG4gICAgICApO1xuICAgIG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxuICAgICAgLnNldE5hbWUoXCJBbGxvdyBlbXB0eSB0YWJzXCIpXG4gICAgICAuc2V0RGVzYyhcbiAgICAgICAgXCJEaXNhYmxlIHRvIGNsb3NlIHRoZSB3aW5kb3cgaW1tZWRpYXRlbHkgd2hlbiB0aGUgbGFzdCB0YWIgaXMgY2xvc2VkLCBpbnN0ZWFkIG9mIHNwYXduaW5nIGFuIGVtcHR5IHRhYi5cIlxuICAgICAgKVxuICAgICAgLmFkZFRvZ2dsZSgodG9nZ2xlKSA9PlxuICAgICAgICB0b2dnbGVcbiAgICAgICAgICAuc2V0VmFsdWUodGhpcy5wbHVnaW4uc2V0dGluZ3MuYWxsb3dFbXB0eSlcbiAgICAgICAgICAub25DaGFuZ2UoYXN5bmMgKHZhbHVlKSA9PiB7XG4gICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5hbGxvd0VtcHR5ID0gdmFsdWU7XG4gICAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcbiAgICAgICAgICB9KVxuICAgICAgKTtcbiAgfVxufVxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgTm9FbXB0eVdpbmRvd3MgZXh0ZW5kcyBQbHVnaW4ge1xuICBzZXR0aW5nczogTXlQbHVnaW5TZXR0aW5ncztcbiAgYXN5bmMgb25sb2FkKCkge1xuICAgIGF3YWl0IHRoaXMubG9hZFNldHRpbmdzKCk7XG4gICAgdGhpcy5hZGRTZXR0aW5nVGFiKG5ldyBTZXR0aW5nVGFiKHRoaXMuYXBwLCB0aGlzKSk7XG4gICAgdGhpcy5hZGRDb21tYW5kKHtcbiAgICAgIGlkOiBcImNsb3NlLXRhYi1vci1lbXB0eS13aW5kb3dcIixcbiAgICAgIG5hbWU6IFwiQ2xvc2UgY3VycmVudCB0YWIgb3IgZW1wdHkgd2luZG93XCIsXG4gICAgICBjYWxsYmFjazogKCkgPT4ge1xuICAgICAgICBjb25zdCB3b3Jrc3BhY2UgPSB0aGlzLmFwcC53b3Jrc3BhY2U7XG4gICAgICAgIGNvbnN0IGxlYXZlczogV29ya3NwYWNlTGVhZltdID0gW107XG4gICAgICAgIHdvcmtzcGFjZS5pdGVyYXRlQWxsTGVhdmVzKChsZWFmKSA9PiB7XG4gICAgICAgICAgbGVhZi52aWV3Lm5hdmlnYXRpb24gJiYgbGVhdmVzLnB1c2gobGVhZik7XG4gICAgICAgIH0pO1xuICAgICAgICBjb25zdCBhY3RpdmVMZWFmID0gd29ya3NwYWNlLmdldE1vc3RSZWNlbnRMZWFmKCk7XG4gICAgICAgIGxldCBhY3RpdmVHcm91cCA9IGFjdGl2ZUxlYWYhLnBhcmVudDtcbiAgICAgICAgc3dpdGNoICh0cnVlKSB7XG4gICAgICAgICAgY2FzZSB0aGlzLnNldHRpbmdzLnVucGluICYmIGFjdGl2ZUxlYWY/LmdldFZpZXdTdGF0ZSgpLnBpbm5lZDpcbiAgICAgICAgICAgIGFjdGl2ZUxlYWYhLnNldFBpbm5lZChmYWxzZSk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBjYXNlIGxlYXZlcy5sZW5ndGggPT09IDEgJiZcbiAgICAgICAgICAgIGFjdGl2ZUxlYWYhLnZpZXcuZ2V0Vmlld1R5cGUoKSA9PT0gXCJlbXB0eVwiOlxuICAgICAgICAgICAgYWN0aXZlTGVhZiEuZ2V0Q29udGFpbmVyKCkud2luLmNsb3NlKCk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBjYXNlIGxlYXZlcy5sZW5ndGggPT09IDEgJiZcbiAgICAgICAgICAgICghdGhpcy5zZXR0aW5ncy5hbGxvd0VtcHR5IHx8XG4gICAgICAgICAgICAgICh0aGlzLnNldHRpbmdzLmFsbG93RW1wdHkgJiZcbiAgICAgICAgICAgICAgICBhY3RpdmVMZWFmIS52aWV3LmdldFZpZXdUeXBlKCkgPT09IFwiZW1wdHlcIikpOlxuICAgICAgICAgICAgYWN0aXZlTGVhZiEuZ2V0Q29udGFpbmVyKCkud2luLmNsb3NlKCk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBjYXNlIGxlYXZlcy5sZW5ndGggPiAxICYmIGFjdGl2ZUdyb3VwLmNoaWxkcmVuLmxlbmd0aCA9PT0gMTpcbiAgICAgICAgICAgIGNvbnN0IHJlbGF0aXZlcyA9IGFjdGl2ZUdyb3VwLnBhcmVudC5jaGlsZHJlbjtcbiAgICAgICAgICAgIGNvbnN0IGFjdGl2ZUdyb3VwcyA9XG4gICAgICAgICAgICAgIHJlbGF0aXZlcy5sZW5ndGggPiAxXG4gICAgICAgICAgICAgICAgPyByZWxhdGl2ZXNcbiAgICAgICAgICAgICAgICAgICAgLmZpbHRlcigoY2hpbGQ6IFdvcmtzcGFjZUxlYWYpID0+IGNoaWxkICE9IGFjdGl2ZUdyb3VwKVxuICAgICAgICAgICAgICAgICAgICAuc29ydChcbiAgICAgICAgICAgICAgICAgICAgICAoYTogYW55LCBiOiBhbnkpID0+IGEuY2hpbGRyZW4ubGVuZ3RoIC0gYi5jaGlsZHJlbi5sZW5ndGhcbiAgICAgICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgIDogWy4uLm5ldyBTZXQobGVhdmVzLm1hcCgobGVhZjogYW55KSA9PiBsZWFmLnBhcmVudCkpXVxuICAgICAgICAgICAgICAgICAgICAuZmlsdGVyKChncm91cCkgPT4gZ3JvdXAgIT0gYWN0aXZlR3JvdXApXG4gICAgICAgICAgICAgICAgICAgIC5zb3J0KChhLCBiKSA9PiBhLmNoaWxkcmVuLmxlbmd0aCAtIGIuY2hpbGRyZW4ubGVuZ3RoKTtcbiAgICAgICAgICAgIGFjdGl2ZUdyb3VwID0gYWN0aXZlR3JvdXBzWzBdO1xuICAgICAgICAgICAgY29uc3QgYWN0aXZlTGVhdmVzID0gYWN0aXZlR3JvdXAuY2hpbGRyZW47XG4gICAgICAgICAgICBjb25zdCBuZXh0QWN0aXZlTGVhZiA9IGFjdGl2ZUxlYXZlc1thY3RpdmVHcm91cC5jdXJyZW50VGFiXTtcbiAgICAgICAgICAgIHdvcmtzcGFjZS5zZXRBY3RpdmVMZWFmKG5leHRBY3RpdmVMZWFmLCB7IGZvY3VzOiB0cnVlIH0pO1xuICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICBhY3RpdmVMZWFmIS5kZXRhY2goKTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICB9KTtcbiAgfVxuICBvbnVubG9hZCgpIHt9XG4gIGFzeW5jIGxvYWRTZXR0aW5ncygpIHtcbiAgICB0aGlzLnNldHRpbmdzID0gT2JqZWN0LmFzc2lnbih7fSwgREVGQVVMVF9TRVRUSU5HUywgYXdhaXQgdGhpcy5sb2FkRGF0YSgpKTtcbiAgfVxuICBhc3luYyBzYXZlU2V0dGluZ3MoKSB7XG4gICAgYXdhaXQgdGhpcy5zYXZlRGF0YSh0aGlzLnNldHRpbmdzKTtcbiAgfVxufVxuIl0sCiAgIm1hcHBpbmdzIjogIjs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBLHNCQU1PO0FBT1AsSUFBTSxtQkFBcUM7QUFBQSxFQUN6QyxPQUFPO0FBQUEsRUFDUCxZQUFZO0FBQ2Q7QUFFQSxJQUFNLGFBQU4sY0FBeUIsaUNBQWlCO0FBQUEsRUFFeEMsWUFBWSxLQUFVLFFBQXdCO0FBQzVDLFVBQU0sS0FBSyxNQUFNO0FBQ2pCLFNBQUssU0FBUztBQUFBLEVBQ2hCO0FBQUEsRUFDQSxVQUFnQjtBQUNkLFVBQU0sRUFBRSxZQUFZLElBQUk7QUFDeEIsZ0JBQVksTUFBTTtBQUNsQixRQUFJLHdCQUFRLFdBQVcsRUFDcEIsUUFBUSxZQUFZLEVBQ3BCLFFBQVEsK0RBQStELEVBQ3ZFO0FBQUEsTUFBVSxDQUFDLFdBQ1YsT0FBTyxTQUFTLEtBQUssT0FBTyxTQUFTLEtBQUssRUFBRSxTQUFTLE9BQU8sVUFBVTtBQUNwRSxhQUFLLE9BQU8sU0FBUyxRQUFRO0FBQzdCLGNBQU0sS0FBSyxPQUFPLGFBQWE7QUFBQSxNQUNqQyxDQUFDO0FBQUEsSUFDSDtBQUNGLFFBQUksd0JBQVEsV0FBVyxFQUNwQixRQUFRLGtCQUFrQixFQUMxQjtBQUFBLE1BQ0M7QUFBQSxJQUNGLEVBQ0M7QUFBQSxNQUFVLENBQUMsV0FDVixPQUNHLFNBQVMsS0FBSyxPQUFP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
